%-*-octave-*--
%
% tr_setup: setup data structure for optimization
%
% USAGE:
%  [x0, optop] = tr_setup( max_iter )
%
% INPUT:
% None
%
% OUTPUT:
% x0: column vector with the initial parameter guess
% optop: structure holding setting for optimizer
%
function [x0, optop] = tr_setup( max_iter )
  if nargin < 1
    max_iter = -1;
  end
  
  verbose=1;

				# 4 frequencies, xi=1
  x0 = [-1.2712e-03,   8.3987e-02,   1.0116e+00,   3.7495e-01]';

				# 4 frequencies, xi=0
  x0 =[-0.136577, 0.027567, 3.107615, -0.014116]';

				# 4 frequencies, xi=1, starting from 0
  x0 = [ 1.066977e-05, 2.839826e-05, 1.588416e-01, -2.547200e-04]';

				# 16 param, starting from 4 param sol
  x0 = zeros(16,1);
  x0(1:4)  = [ 0, 0, 1.6, 0]';
  optop = optimset("GradObj", "on", "OutputFcn", @user_output);

  x0=[ -1.547581e-02, -5.039438e-03, 6.232726e-01, -1.614646e-02, 1.115364e-02, -1.722819e-02, -1.790503e-02, 1.489964e-01,...
       1.517368e-02, 1.636050e-01, 2.882283e-02, -1.479121e-01, 1.975690e-03, -1.531156e-01, 3.318510e-02, -3.849679e-02]';

				# 20 param: 5 freq x 4 wavelets
  x0=[-0.01548, -0.00504,  0.62327, -0.01615,  0.00000,  0.01115, -0.01723, -0.01791,  0.14900,  0.00000,  0.01517,  0.16361,...
      0.02882, -0.14791,  0.00000,  0.00198, -0.15312,  0.03319, -0.03850,  0.00000]';
# f=7.252443e-02
  x0=[-0.0711450, -0.1636703,  0.6235163,  0.1093650, -0.0372585,  0.0289973,  0.0510396, -0.0256251,  0.1163426, -0.0686200, ...
      0.0645165,  0.3277749,  0.0072814, -0.3049846,  0.1668028,  0.0445211, -0.0591511,  0.0410563, -0.0537391, -0.0109665];
				# 6x6 case, Nguard=0
  x0=[ -9.319677e-02, 6.333422e-02, 8.268004e-01, -4.046756e-02, -1.904017e-01, -2.012154e-01, -1.211908e-01, -4.095817e-01, 4.856449e-01, 1.198752e-01, 1.987238e-01, 2.923154e-01, 2.504597e-01, -2.417862e-01, 2.431973e-01, 1.750985e-01, -5.102488e-01, -2.757555e-01, 6.052043e-02, 1.178891e-01]';
				# 4x4 case, Nguard=0, 16 parameters, f=5.336997e-03
  x0=[ -1.986148e+00, 2.040207e+00, -1.866025e-01, 4.710688e-06, 1.368235e+00, -1.099703e+00, 6.346952e-01, -4.826992e-05, 2.727809e+00, -2.186289e+00, 1.576340e-01, 1.250730e-05, -1.563122e-01, -1.179644e+00, 3.110521e-01, -1.027458e-05]';

# 4x4 case, Nguard=0, 24 parameters, f=8.020662e-06
  x0 =[ -2.110246e+00, 2.224727e+00, 3.706019e-01, 4.000065e-06, 1.424137e+00, -1.204303e+00, 4.282084e-01, -1.879225e-04, 2.909133e+00, -2.362898e+00, -4.589281e-01, 3.066231e-05, -2.929780e-01, -9.860660e-01, -5.136512e-01, 7.619420e-05, 2.824097e-01, -3.023546e-01, 8.640791e-01, -1.176891e-04, -8.395438e-02, 1.764170e-02, 2.243121e-01, -2.915649e-05 ]';

			  # 6x4 case, Nguard=2, 5 freq x 1 wavelet = 5param, initial guess
  x0 = zeros(5,1);
			  # 6x4 case, Nguard=2, 5 freq x 3 wavelets = 15 param, after ~15 iter, f=3.171117e-01
  x0 =[ -6.387003e-02, -1.646755e-01, 2.371812e-01, 8.848997e-02, -1.600555e-02, -9.731817e-03, 1.754703e-01, 1.153159e-02, -2.071537e-01, -2.087756e-01, 6.981120e-02, -7.155032e-02, 1.989982e-01, 2.022569e-01, -5.255969e-01 ]';

			  # 6x4 case, Nguard=2, 5 freq x 3 wavelets = 15 param, f= 3.325442e-02
  x0 =[ 6.198974e-02, -8.667081e-02, 2.777456e-01, -1.150964e-01, 6.316024e-01, -1.068884e-01, 1.556276e-01, 3.185325e-01, -3.907395e-01, -7.348174e-02, 4.324063e-02, -1.006067e-01, -2.638719e-01, 3.227226e-01, -7.620153e-01]';
			  # 6x4 case, Nguard=2, 5 freq x 5 wavelets = 25 param, f=7.560265e-02 (alpha=0.05)
  x0 =[ -2.363515e-01, 1.937362e-01, 8.689657e-01, 7.097609e-01, 6.324675e-01, 1.116565e+00, -1.149909e-01, -7.019906e-02, -2.613137e-01, -2.388956e-01, 2.662338e-01, 2.346402e-01, -8.190857e-01, -7.372692e-01, -7.015207e-01, -9.327992e-01, -4.806243e-01, -8.258083e-01, -3.789903e-01, -7.223328e-01, -1.287833e-01, 2.139173e-01, 6.463392e-01, -4.395580e-01, 6.007147e-01 ]';
  
# 6x4 case, Nguard=2, 5 freq x 5 wavelets = 25 param, new initial guess
  x0 = zeros(25,1);

  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param, f=1.311869e-02
  x0 =[ 5.485277e-02, -1.470214e-01, 1.565667e-01, 5.650914e-02, -1.880350e-01, -2.785077e-02, 5.296297e-02, 7.382663e-02, -2.637490e-02, -1.291475e-01, -7.496319e-02, 1.821377e-01, 2.054527e-01, -8.096580e-02, -2.228666e-01, -6.848295e-02, 5.651204e-02, -1.440104e-01, -3.216984e-02, 1.508521e-01, 3.377522e-02, -5.389127e-02, -3.027566e-01, -5.784030e-02, -1.742684e-02, 1.218241e-01, 8.148633e-02, -7.586688e-02, 1.412936e-01, 1.817376e-01 ]';
  
  # 6x4 case, Nguard=2, 5 freq x 4 wavelets = 20 param, new initial guess
  x0 = zeros(20,1);

  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param, new initial guess
  x0 = zeros(30,1);

  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param,  T=20, tp=T/50 in weightf and penalf; gate fidelity = 9.996020e-01
  ## x0 = =[ 1.203002e-01, 8.590182e-01, 8.437379e-01, 9.337177e-02, 7.605563e-01, 1.474008e-01, -3.803610e-01, 2.106179e-02, 4.868008e-02, -3.844308e-01, -3.318138e-02, -7.555135e-01, -8.014872e-01, -1.467892e-01, 2.989396e-01, -3.720017e-02, -8.899256e-01, -2.731871e-01, -3.727800e-01, -3.867619e-01, -1.001672e+00, 8.789123e-01, -8.428991e-01, 7.590871e-01, -3.184582e-01, -2.828073e-01, 7.791866e-01, -1.290392e-01, -1.154583e-01, 6.970464e-01 ]';

  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param, new case; tp=T/10 and new scaling between gate and guard levels
  x0 = zeros(30,1);
  
  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param, T=20; tp=T/10 and new scaling between gate and guard levels. Final gate fidelity = 9.999873e-01, norm2 of final guard levels = 5.558054e-05
  x0=[ 1.249315e+00, 2.552037e-01, 1.211419e+00, -2.932637e-01, -9.918166e-01, -3.172579e-01, -7.624694e-02, -2.990807e-01, 2.512575e-01, 4.947766e-01, -1.459644e+00, 7.616752e-02, -7.483667e-01, 3.889136e-01, 1.103104e+00, -4.031798e-01, -7.295773e-01, -3.521408e-01, 2.215266e-01, 6.013941e-01, -7.441991e-01, 7.139270e-01, 1.188278e-01, -1.816066e-01, -4.714749e-01, -8.119987e-02, -1.508724e-03, -2.812855e-02, 2.531161e-01, 3.123944e-01]';

  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param, T=30; tp=T/10 and new scaling between gate and guard levels. Final gate fidelity = 9.999870e-01, norm2 of final guard levels = 6.781803e-06
  x0=[ -7.057019e-02, -2.118277e-01, 1.867419e-01, 9.897596e-02, -6.883136e-01, 8.543304e-02, 2.205359e-01, 2.221996e-01, 6.136971e-02, 3.630116e-01, 2.141289e-02, 1.423540e-01, 1.584807e-01, -1.645265e-01, 8.593582e-01, 6.392461e-02, 1.808111e-01, 5.041085e-01, 1.667947e-02, 2.762291e-01, -6.348029e-03, 4.901129e-02, -9.864969e-01, 1.846058e-02, -5.153485e-02, -1.911149e-02, -1.032585e-01, 1.561671e-01, 3.996010e-02, -2.717101e-02]';

  # 6x4 case, Nguard=2, 5 freq x 6 wavelets = 30 param, T=30; const=T/10 and new scaling between gate and guard levels. Final gate fidelity = 9.978570e-01, norm2 of final guard levels = 1.268322e-06
  x0=[ -4.549799e-01, -6.735517e-02, 4.341718e-01, 5.721000e-02, -2.634796e-01, 1.873049e-01, 1.741878e-01, 7.087328e-02, 3.725818e-02, 1.136330e-01, 5.064778e-01, 9.791369e-03, -8.186303e-03, -1.186580e-01, 4.011501e-01, 2.978254e-01, 8.646609e-02, 2.862623e-01, 6.763582e-02, 6.530117e-02, -1.950895e-01, 2.858322e-02, -9.661136e-01, -1.710277e-01, 1.276695e-02, 1.109519e-01, -7.070366e-02, 2.578915e-01, 2.490581e-01, 1.938060e-01]';
  
  if (max_iter > 0)
    optop = optimset(optop, "MaxIter", max_iter);
  end

  if (verbose)
    printf("x0: "); x0
    printf("optop:\n"); optop
  end
end
