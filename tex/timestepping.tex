\documentclass[12pt]{article}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{dsfont}

\begin{document}
Solving the vectorized Liouville-von-Neumann equations for the real and imaginary part of the density matrix $\rho = u + iv$:
\begin{align}\label{ODEsystem}
  \begin{bmatrix}
    \dot u \\ \dot v
  \end{bmatrix} = 
  \begin{bmatrix}
      A(t) & -B(t) \\
      B(t) & A(t) 
  \end{bmatrix}
  \begin{bmatrix}
     u \\  v
  \end{bmatrix}
\end{align}
with $A^T=-A, B^T=B$. 

\section{Backward-Euler}

Compute $u^{n+1}, v^{n+1}$ from 
\begin{align}
  \begin{bmatrix}
    u^{n+1} \\ v^{n+1} 
  \end{bmatrix} = 
  \begin{bmatrix}
    I - \delta t A^{n+1} & \delta t B^{n+1} \\ -\delta t A^{n+1} & I-\delta t B^{n+1}
  \end{bmatrix}^{-1}
  \begin{bmatrix}
    u^{n} \\ v^{n} 
  \end{bmatrix}
\end{align}

\section{Stromer-Verlet} 

(Including forcing $F_u, F_v$).
Compute $u^{n+1}, v^{n+1}$ from 
\begin{align}
  \left(I - \frac{\delta t}{2} A^{n}\right) \ell_1 &= B^n u^n + A^n v^n + F_v^n,\\
%
  v^{n+1/2} &= v^n + \frac{\delta t}{2}\ell_1,\\
  %
  \kappa_1 &= A^{n+1/2} u^n - B^{n+1/2} v^{n+1/2} +
  F_u^{n+1/2},\\
%
  \left(I - \frac{\delta t}{2} A^{n+1/2}\right) \kappa_2 &= A^{n+1/2}\left( u^n + \frac{\delta t}{2}
  \kappa_1 \right) - B^{n+1/2}  v^{n+1/2} + F_u^{n+1/2},\\
  %
  u^{n+1} &= u^n + \frac{\delta t}{2}\left( \kappa_1 + \kappa_2 \right),\\
%
  \ell_2 &= B^{n+1} u^{n+1} + A^{n+1}  v^{n+1/2} + F_v^{n+1},\\
  %
  v^{n+1} &= v^n + \frac{\delta t}{2}\left( \ell_1 + \ell_2 \right).
\end{align}

Neglecting $F_u, F_v$, the matrix notation of one time-step is
\begin{align}
  \begin{bmatrix}
    u^{n+1} \\ v^{n+1}
  \end{bmatrix} = 
  \begin{bmatrix}
    A_{11} & A_{12} \\ A_{21} & A_{22}
  \end{bmatrix}
  \begin{bmatrix}
    u^n \\ v^n
  \end{bmatrix} 
\end{align}

with
\begin{align}
   A_{11} &=  I - \frac{\delta t^2}{2^2}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12} \\
   & + \frac{\delta t}{2}A^{n}  \\
       & - \frac{\delta t^2}{2^2}(I - \frac{\delta t}{2}A^{n+1})^{-1}B^{n+1}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12}   \\
       & + \frac{\delta t}{2}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1} \\
       & - \frac{\delta t^3}{2^3}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12} \\
       & + \frac{\delta t^2}{2^2}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}A^{n}
\end{align}
\begin{align}
  A{12} &= -\frac{\delta t}{2}B^{n} \\
    & - \frac{\delta t^2}{2^2}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12} \\
    & - \frac{\delta t}{2}(I - \frac{\delta t}{2}A^{n+1})^{-1}B^{n+1}  \\
    & - \frac{\delta t^2}{2^2}(I - \frac{\delta t}{2}A^{n+1})^{-1}B^{n+1}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12} \\
    & - \frac{\delta t^2}{2^2}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}B^{n} \\
    & - \frac{\delta t^3}{2^3}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12} 
\end{align}
\begin{align}
 A{21} &= \frac{\delta t}{2}B^{n+\frac 12} \\
   & - \frac{\delta t^3}{2^3}B^{n+\frac 12}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12} \\
   & + \frac{\delta t^2}{2^2}B^{n+\frac 12}A^{n} \\
   & - \frac{\delta t^3}{2^3}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}B^{n+1}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12} \\
   & + \frac{\delta t^2}{2^2}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1} \\
   &- \frac{\delta t^4}{2^4}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12} \\
   & + \frac{\delta t^3}{2^3}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}A^{n} \\
    & + \frac{\delta t^2}{2^2}A^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12} \\
    & + \frac{\delta t}{2}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}B^{n+\frac 12}
\end{align}
\begin{align}
 A_{22} &= I - \frac{\delta t^2}{2^2}B^{n+\frac 12}B^{n} \\
 & - \frac{\delta t^3}{2^3}B^{n+\frac 12}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12}  \\
  & - \frac{\delta t^2}{2^2}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}B^{n+1} \\
  & - \frac{\delta t^3}{2^3}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}B^{n+1}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12} \\
  & - \frac{\delta t^3}{2^3}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}B^{n} \\
  & - \frac{\delta t^4}{2^4}B^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+1})^{-1}A^{n+1}B^{n}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12}  \\
  & + \frac{\delta t}{2}A^{n+\frac 12} \\
  & + \frac{\delta t^2}{2^2}A^{n+\frac 12}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12} \\
  & + \frac{\delta t}{2}(I - \frac{\delta t}{2}A^{n+\frac 12})^{-1}A^{n+\frac 12}
\end{align}



\section{Testproblems}

\subsection{$1$ oscillator system with $2$ levels - Case 1}
Consider a $1$ oscillator system with $2$ levels $\Rightarrow a = a_1 = \begin{pmatrix} 0 & 1 \\ 0 & 0 \end{pmatrix}$, $N=2^1 = 2$.
Consider the Hamiltonian 
\begin{align*}
H(t) &= f_1(t) (a_1 + a_1^{\dagger})\\ 
\text{with} \quad &f_1(t) = \frac 14(1-\cos(wt)), \quad a_1 + a_1^{\dagger} = \begin{pmatrix} 0 & 1 \\ 1 & 0 \end{pmatrix}
\end{align*}
when solving the Liouville-von-Neumann equation for the density matrix $\rho \in \mathds{C}^{2\times 2}$. After vectorization $\text{vec} \rho =: \tilde \rho \in \mathds{C}^4$ we solve
\begin{align*}
   \dot{\tilde\rho} & = -i(I_2 \otimes H - H^T \otimes I_2) \tilde\rho \\
                     &= if_1(t) 
                  \underbrace{\begin{pmatrix}
                  0 & -1 & 1 & 0 \\
                 -1 &  0 & 0 & 1 \\
                  1 &  0 & 0 & -1\\
                  0 &  1 & -1& 0 \\
                  \end{pmatrix}}_{=: B_0} \tilde \rho
\end{align*}
 Hence, $A(t) = 0  \in \mathds{R}^{4\times 4}$ and $B(t) = f_1(t) B_0$ for the system in \eqref{ODEsystem}.


\subsection{$1$ oscillator system with $2$ levels - Case 2}
Consider a $1$ oscillator system with $2$ levels $\Rightarrow a = a_1 = \begin{pmatrix} 0 & 1 \\ 0 & 0 \end{pmatrix}$, $N=2^1 = 2$.
Consider the Hamiltonian 
\begin{align*}
H(t) &= ig_1(t) (a_1 - a_1^{\dagger})\\ 
\text{with} \quad &g_1(t) = \frac 14(1-\sin(wt)), \quad a_1 - a_1^{\dagger} = \begin{pmatrix} 0 &1 \\ -1 & 0 \end{pmatrix}
\end{align*}
when solving the Liouville-von-Neumann equation for the density matrix $\rho \in \mathds{C}^{2\times 2}$. After vectorization $\text{vec} \rho =: \tilde \rho \in \mathds{C}^4$ we solve
\begin{align*}
   \dot{\tilde\rho} & = -i(I_2 \otimes H - H^T \otimes I_2) \tilde\rho \\
                     &= g_1(t) 
                  \underbrace{\begin{pmatrix}
                  0 &  1 & -1& 0 \\
                 -1 &  0 & 0 & -1\\
                  1 &  0 & 0 &  1\\
                  0 &  1 & -1& 0 \\
                  \end{pmatrix}}_{=: A_0} \tilde \rho
\end{align*}
 Hence, $A(t) = g_1(t)A_0$ and $B(t) =  0$ for the system in \eqref{ODEsystem}.




\subsection{$2$ oscillators, $2$ levels}
Consider $2$ oscillator system with $n=2$ levels $\Rightarrow a_1 = \begin{pmatrix} 0 & 1 \\ 0 & 0 \end{pmatrix}$ and $a = a_1\otimes I_2, b = I_2 \otimes a_1$.

Consider the Hamiltonian  
\begin{align*}
  H(t) &:= f_1(t) (a+a^{\dagger} ) + ig_1(t)(a-a^{\dagger})  \\
  & = 
  \begin{pmatrix}
      0      & ig_1(t) & f_1(t) & 0 \\
     -ig_1(t) & 0      & 0      & f_1(t) \\
      f_1(t) & 0      & 0      & ig_1(t) \\
      0      & f_1(t) &-ig_1(t) & 0 \\
  \end{pmatrix}
\end{align*}
where
\begin{align*}
  f_1(t) := \frac 14(1-\cos(wt)), \quad g_1(t) := \frac 14 (1-\sin(wt))
\end{align*}

Vectorization and real/imaginary splitting gives the following system matrices:
\begin{align*}
  A(t) &= I_4 \otimes Im(H) - Im(H)^T \otimes I_4 \\
       &= g_1(t) \left( I_4 \otimes (a-a^{\dagger}) - (a-a^{\dagger})^T \otimes I_4 \right) \\
       &= g_1(t)\left(
          \begin{array}{cccc|cccc|cccc|cccc}
            0 & 0 & 1 & 0  &  0 & 0 & 0 & 0  &    1 & 0 & 0 & 0 &  0 & 0 & 0 & 0\\
            0 & 0 & 0 & 1  &  0 & 0 & 0 & 0  &    0 & 1 & 0 & 0 &  0 & 0 & 0 & 0\\
           -1 & 0 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 1 & 0 &  0 & 0 & 0 & 0\\
            0 &-1 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 0 & 1 &  0 & 0 & 0 & 0\\
            \hline
            0 & 0 & 0 & 0  &  0 & 0 & 1 & 0  &    0 & 0 & 0 & 0 &  1 & 0 & 0 & 0\\
            0 & 0 & 0 & 0  &  0 & 0 & 0 & 1  &    0 & 0 & 0 & 0 &  0 & 1 & 0 & 0\\
            0 & 0 & 0 & 0  & -1 & 0 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 1 & 0\\
            0 & 0 & 0 & 0  &  0 &-1 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 0 & 1\\
            \hline
           -1 & 0 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 1 & 0 &  0 & 0 & 0 & 0\\
            0 &-1 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 0 & 1 &  0 & 0 & 0 & 0\\
            0 & 0 &-1 & 0  &  0 & 0 & 0 & 0  &   -1 & 0 & 0 & 0 &  0 & 0 & 0 & 0\\
            0 & 0 & 0 &-1  &  0 & 0 & 0 & 0  &    0 &-1 & 0 & 0 &  0 & 0 & 0 & 0\\
            \hline
            0 & 0 & 0 & 0  &  -1& 0 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 1 & 0\\
            0 & 0 & 0 & 0  &  0 & -1& 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 0 & 1\\
            0 & 0 & 0 & 0  &  0 & 0 & -1& 0  &    0 & 0 & 0 & 0 &  -1& 0 & 0 & 0\\
            0 & 0 & 0 & 0  &  0 & 0 & 0 & -1 &    0 & 0 & 0 & 0 &  0 & -1& 0 & 0\\
       \end{array}
       \right)
\end{align*}
\begin{align*}
  B(t) &= - I_4 \otimes Re(H) + Re(H)^T \otimes I_4 \\
    &= f_1(t) \left( -I_4 \otimes (a+a^{\dagger}) + (a+a^{\dagger})^T\otimes I_4 \right)\\
    &= f_1(t) \left(
          \begin{array}{cccc|cccc|cccc|cccc}
            0 & 0 &-1 & 0  &  0 & 0 & 0 & 0  &    1 & 0 & 0 & 0 &  0 & 0 & 0 & 0\\
            0 & 0 & 0 &-1  &  0 & 0 & 0 & 0  &    0 & 1 & 0 & 0 &  0 & 0 & 0 & 0\\
            -1& 0 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 1 & 0 &  0 & 0 & 0 & 0\\
            0 & -1& 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 0 & 1 &  0 & 0 & 0 & 0\\
            \hline
            0 & 0 & 0 & 0  &  0 & 0 &-1 & 0  &    0 & 0 & 0 & 0 &  1 & 0 & 0 & 0\\
            0 & 0 & 0 & 0  &  0 & 0 & 0 &-1  &    0 & 0 & 0 & 0 &  0 & 1 & 0 & 0\\
            0 & 0 & 0 & 0  &  -1& 0 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 1 & 0\\
            0 & 0 & 0 & 0  &  0 &-1 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 0 & 1\\
            \hline
            1 & 0 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & -1& 0 &  0 & 0 & 0 & 0\\
            0 & 1 & 0 & 0  &  0 & 0 & 0 & 0  &    0 & 0 & 0 & -1&  0 & 0 & 0 & 0\\
            0 & 0 & 1 & 0  &  0 & 0 & 0 & 0  &    -1& 0 & 0 & 0 &  0 & 0 & 0 & 0\\
            0 & 0 & 0 & 1  &  0 & 0 & 0 & 0  &    0 & -1& 0 & 0 &  0 & 0 & 0 & 0\\
            \hline
            0 & 0 & 0 & 0  &  1 & 0 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & -1& 0\\
            0 & 0 & 0 & 0  &  0 & 1 & 0 & 0  &    0 & 0 & 0 & 0 &  0 & 0 & 0 &-1\\
            0 & 0 & 0 & 0  &  0 & 0 & 1 & 0  &    0 & 0 & 0 & 0 &  -1& 0 & 0 & 0\\
            0 & 0 & 0 & 0  &  0 & 0 & 0 & 1  &    0 & 0 & 0 & 0 &  0 & -1& 0 & 0\\
          \end{array}
    \right)
\end{align*}
% For the vectorized system in $u, v \in \mathds{R}^{16}$ we get

\end{document}
